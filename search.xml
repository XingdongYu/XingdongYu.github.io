<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[æ‰“é€ ä¸€ä¸ªå¯å®šåˆ¶çš„PathåŠ¨ç”»]]></title>
    <url>%2F2018%2F07%2F15%2Fsimple-line-view%2F</url>
    <content type="text"><![CDATA[å‰è¨€åˆ›å»ºè¿™ä¸ªåº“å¹¶éžæ˜¯ç”±äºŽæŸä¸ªéœ€æ±‚ï¼Œè€Œæ˜¯ä»¥å‰åœ¨é˜…è¯»OkHttpæºç æ—¶æ·±æ„Ÿè®¾è®¡çš„ç²¾å¦™ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªæ¨¡ä»¿å…¶è´£ä»»é“¾æ¨¡å¼åšä¸€ä¸ªè‡ªå®šä¹‰View(SimpleLineView)çš„æƒ³æ³•ï¼Œä¸€æ˜¯ä¸ºäº†å¥½çŽ©ï¼ŒäºŒæ˜¯å¸Œæœ›èƒ½å¤ŸæŠ›ç –å¼•çŽ‰ã€‚ å¯¹äºŽViewçš„pathåŠ¨ç”»ï¼ŒPathAnimViewç”šè‡³æ˜¯Lottieç­‰éƒ½å¯ä»¥ä½œå‡ºååˆ†å¤æ‚é…·ç‚«çš„pathåŠ¨ç”»ã€‚å¦‚æžœä½ çš„åŠ¨ç”»å¾ˆå¤æ‚å¾ˆé…·ç‚«ï¼Œè¿™ä¸ªåº“å¯èƒ½å°±ä¸å¤ªé€‚åˆäº†ã€‚ å½“ç„¶ï¼ŒSimpleLineViewä¹Ÿæœ‰è‡ªå·±çš„ä¼˜åŠ¿ï¼š1ã€å¯éšæ„å®šåˆ¶è·¯å¾„2ã€è·¯å¾„å¯ä»¥éšæ„ç»„åˆ3ã€æ”¯æŒprogress æ•ˆæžœå›¾ æ•´ä½“æž¶æž„1ã€è‡ªå®šä¹‰Painterï¼ˆç»˜åˆ¶ç›¸å…³æŽ¥å£ï¼‰ï¼Œæä¾›ç»˜åˆ¶åŠŸèƒ½ã€‚2ã€RealChainå®žçŽ°äº†ChainæŽ¥å£å¹¶ä¸”ç»´æŠ¤äº†ä¸€ä¸ªPainterçš„listï¼ŒæŽ§åˆ¶æ‰€æœ‰Painterä¾æ¬¡æ‰§è¡Œç»˜åˆ¶ã€‚3ã€SimpleLineViewç»´æŠ¤äº†ä¸€ä¸ªRealChainå¹¶ä¸”å¯¹å¤–æä¾›äº†æ–¹æ³•ï¼Œç”¨äºŽæ·»åŠ Painterä»¥åŠæŽ§åˆ¶åŠ¨ç”»çš„å¯åŠ¨ã€åœæ­¢å’Œç»§ç»­ã€‚åœ¨onDrawé‡Œè°ƒç”¨å½“å‰Painterçš„onDrawæ–¹æ³•å®žçŽ°çœŸæ­£çš„ç»˜åˆ¶ã€‚ ä½¿ç”¨1234567891011121314// åœ†å½¢PixelPath circlePath = new PixelPath(10, 10, new int[]&#123;1, 100&#125;);CirclePainter ciclePainter = new RealCirclePainter(circlePath, 1000, -120, 360, false);// çŸ©å½¢PixelPath squarePath = new PixelPath(2, 2, new int[]&#123;1, 2, 4, 3&#125;);Painter squarePainter = new SegmentPainter(squarePath, 1000, true);// æ·»åŠ è·¯å¾„mView.addPainter(ciclePainter).addPainter(squarePainter);// å¯åŠ¨mView.start();// åœæ­¢mView.stop();// ç»§ç»­mView.stick(); å‰æœŸå‡†å¤‡ï¼šPixelPath1234567// æ¨ªå‘åƒç´ private int mHorizontal;// çºµå‘åƒç´ private int mVertical;// è·¯å¾„ç»è¿‡çš„åƒç´ åºå·private int[] mPath;SimpleLineViewå°†Viewçš„é•¿å’Œå®½åˆ†æˆè‹¥å¹²ä¸ªæ ¼å­ï¼Œæ ¼å­æ•°ç”±å›¾ç‰‡çš„åƒç´ å†³å®šï¼Œå¹¶ä¸”è§„å®šäº†pathçš„åºå·ï¼ˆä»Ž1å¼€å§‹ï¼Œä»Žå·¦å¾€å³ã€ä»Žä¸Šåˆ°ä¸‹ä¾æ¬¡é€’å¢ž1ï¼‰ã€‚ ä¾‹å¦‚ï¼Œä¸€å¼ åƒç´ ä¸º4 * 4çš„å›¾ç‰‡ è¿™é‡Œçš„mHorizontal(æ¨ªå‘æ ¼å­æ•°)å’ŒmVertical(çºµå‘æ ¼å­æ•°)éƒ½ä¸º4ã€‚å¦‚æžœmPathä¸º{1, 13, 16, 4}, åˆ™ç»˜åˆ¶çš„å›¾å½¢ä¸ºä¾æ¬¡è¿žæŽ¥1ï¼Œ13ï¼Œ16ï¼Œ4çš„çŸ©å½¢(æ˜¯å¦å°é—­å¯è®¾ç½®å¯¹åº”å‚æ•°)ã€‚å¦‚æžœå›¾å½¢çš„å½¢çŠ¶æ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥ç”¨PSæ‰“å¼€å›¾ç‰‡ï¼Œä¾æ¬¡èŽ·å–åƒç´ ç‚¹çš„xå’Œyå€¼(è¿™é‡Œxå’Œyå€¼çš„å•ä½å¯ä»¥æ˜¯åƒç´ ã€åŽ˜ç±³ç­‰ï¼Œä½†æ˜¯è®¡ç®—æ—¶è¦ä¸Žå›¾åƒå¤§å°çš„å•ä½ä¸€è‡´)ã€‚å‡è®¾å›¾åƒå®½ä¸ºw, é«˜ä¸ºh, åˆ™å½“å‰ç‚¹çš„å€¼ä¸º w * ( y - 1) + xã€‚ PainteræŽ¥å£PainteræŽ¥å£ä¸»è¦æä¾›äº†ç»˜åˆ¶çš„åŠŸèƒ½ä»¥åŠç»˜åˆ¶æ—¶æ‰€éœ€è¦çš„ä¸€äº›å‚æ•°ã€‚12345678910111213141516171819202122public interface Painter &#123; // èŽ·å–Path PixelPath getPixelPath(); // æ—¶é•¿ int duration(); // è·¯å¾„æ˜¯å¦é—­åˆ boolean close(); // è®¾ç½®Paint void setPaint(Paint paint); // èŽ·å–Paint Paint getPaint(); // åŠ¨ç”»æ˜¯å¦æ­£åœ¨è¿›è¡Œ boolean isRunning(); // å¼€å§‹åŠ¨ç”» void start(Chain chain, Action action); // åœæ­¢åŠ¨ç”» void stop(); // çœŸæ­£ç»˜åˆ¶çš„åœ°æ–¹ void onDraw(Canvas canvas); // è¿›è¡Œä¸‹ä¸€ç¬”ç»˜ç”»æ—¶ï¼Œå®Œæ•´ç”»å®Œå½“å‰ç¬” void completeDraw(Canvas canvas);&#125; onDrawæ–¹æ³•å’ŒViewçš„onDrawæ–¹æ³•ä¸€æ ·å®žçŽ°ç»˜åˆ¶ã€‚è¿™é‡Œä¸»è¦ä»‹ç»ä¸€ä¸‹completeDrawæ–¹æ³•ã€‚ç”±äºŽæ¯ä¸ªPainteræ˜¯ä¾æ¬¡ç»˜åˆ¶çš„ï¼Œå½“ä¸‹ä¸€ä¸ªPainterè¿›è¡Œç»˜åˆ¶æ—¶ï¼Œå½“å‰Pianterçš„å½¢çŠ¶ä¹Ÿéœ€è¦ç»˜åˆ¶ï¼Œæ‰€ä»¥è¿™é‡Œçš„completeDrawåº”è¯¥æ˜¯å½“å‰Painteræ‰€è¦ç»˜åˆ¶çš„å®Œæ•´å½¢çŠ¶ã€‚è¿™ä¸ªæ–¹æ³•ä¼šè¢«å½“å‰Painterä¹‹åŽçš„æ¯ä¸€ä¸ªPainterè°ƒç”¨ã€‚æœ‰ç‚¹ç»•ï¼Œçœ‹ä¸€ä¸‹æŠ½è±¡ç±»AbstractPainterçš„onDrawå®žçŽ°ï¼š1234567@Overridepublic void onDraw(Canvas canvas) &#123; // 1.å®Œæˆä¹‹å‰Painterçš„ç»˜åˆ¶ drawPreviouse(canvas); // 2.ç»˜åˆ¶å½“å‰ realDraw(canvas);&#125; drawPreviouseæ–¹æ³•ï¼š12345678910111213141516/** * å¼€å§‹å½“å‰ç»˜åˆ¶å‰ï¼Œå…ˆå®Œæˆä¹‹å‰çš„ç»˜åˆ¶ * @param canvas */private void drawPreviouse(Canvas canvas) &#123; if (chain != null) &#123; // å½“å‰Painterçš„index final int index = chain.index(); final List&lt;Painter&gt; painters = chain.painters(); // éåŽ†æ‰€æœ‰ä¹‹å‰çš„Painterï¼Œè°ƒç”¨completeDrawæ–¹æ³• for (int i = 0; i &lt; index - 1; i ++) &#123; final Painter painter = painters.get(i); painter.completeDraw(canvas); &#125; &#125;&#125; ä¸ºäº†æ–¹ä¾¿è¯´æ˜Žï¼Œçœ‹ä¸€ä¸‹AbstractPainterçš„ä¸€ä¸ªå­ç±»RealCirclePainterçš„completeDrawå’ŒrealDrawæ–¹æ³•ï¼š123456789@Overridepublic void completeDraw(Canvas canvas) &#123; canvas.drawArc(mRectF, mStartAngle, mSweepAngle, mUseCenter, paint);&#125;@Overrideprotected void realDraw(Canvas canvas) &#123; canvas.drawArc(mRectF, mStartAngle, angle(), mUseCenter, paint);&#125; mSweepAngleæ˜¯æ‰€éœ€æ‰«è¿‡çš„è§’åº¦ï¼Œangle()ä¸ºå½“å‰çš„è§’åº¦å¤§å°ï¼Œè¿™ä¸ªè§’åº¦ä¼šéšç€æ—¶é—´é€’å¢žï¼Œå¦‚æ­¤ä¹Ÿå°±æœ‰äº†åŠ¨ç”»ã€‚å½“ç„¶å¿…é¡»å¾—çœ‹ä¸€ä¸‹AbstractPainterçš„startæ–¹æ³•ï¼Œè¿™ä¸ªæ‰æ˜¯æ¯ä¸ªPainterå¼€å§‹çš„åœ°æ–¹ã€‚123456789101112131415@Overridepublic void start(Chain chain, Action action) &#123; //æ˜¯å¦æ­£åœ¨æ‰§è¡Œ mIsRunning = true; this.chain = chain; // è®¡ç®—å®žé™…åæ ‡ç‚¹ pointList = action.fetchCoordinate(this); // æ‰§è¡Œç»˜åˆ¶ boolean isFinish = performDraw(action); mIsRunning = false; // å¦‚æžœçš„ç¡®ç»˜åˆ¶å®Œæˆï¼Œä¸‹ä¸€æ­¥ if (isFinish) &#123; chain.proceed(); &#125;&#125; fetchCoordinateæ–¹æ³•ä¸ºç»˜åˆ¶æä¾›äº†åæ ‡ç‚¹ï¼Œå®žçŽ°ä¸‹æ–‡ä¼šä»‹ç»ã€‚ä¹‹åŽé€šè¿‡performDrawæ–¹æ³•æ¥å¼€å§‹Viewçš„ç»˜åˆ¶ï¼Œçœ‹ä¸€ä¸‹AbstractPainterå¦ä¸€ä¸ªå­ç±»SegmentPainterçš„performDrawæ–¹æ³•å®žçŽ°ï¼š12345678910111213141516171819202122@Overridepublic boolean performDraw(Action action) &#123; // æ€»è·¯ç¨‹ float distance = Utils.calDistance(pointList, close()); for (int i = 0; i &lt; pointList.size(); i++) &#123; // çœç•¥è‹¥å¹²ä»£ç  while (!current.isPathFinish()) &#123; if (!isRunning()) &#123; return false; &#125; // çœç•¥è®¡ç®—ä»£ç  // æ›´æ–°ç•Œé¢ action.update(this); SystemClock.sleep(INTERVAL); &#125; // ä¿è¯å›¾åƒéƒ½ç»˜åˆ¶ action.update(this); &#125; return true;&#125; åœ¨performDrawæ–¹æ³•ä¸­ä¼šéåŽ†PixelPointçš„listï¼Œæ¯éš”INTERVALæ—¶é—´è°ƒç”¨ActionæŽ¥å£çš„updateæ–¹æ³•æ›´æ–°Viewä¸€æ¬¡ã€‚ ChainæŽ¥å£Chainä¸»è¦æä¾›äº†è°ƒæŽ§çš„åŠŸèƒ½ã€‚1234567891011121314public interface Chain &#123; // æ‰§è¡Œ void proceed(); // å½“å‰Painterçš„index int index(); // è®¾ç½®ç»“æŸç›‘å¬ void setOnFinishListener(OnFinishListener listener); // æ‰€æœ‰çš„Painter List&lt;Painter&gt; painters(); // ç»“æŸæŽ¥å¬æŽ¥å£ interface OnFinishListener &#123; void onFinish(int index); &#125;&#125; çœ‹ä¸€ä¸‹å”¯ä¸€å®žçŽ°ç±»RealChainçš„proceedæ–¹æ³•123456789101112131415161718192021222324@Overridepublic void proceed() &#123; if (mOnFinishListener != null &amp;&amp; mIndex &gt; 0) &#123; mOnFinishListener.onFinish(mIndex - 1); &#125; // å¦‚æžœindexç­‰äºŽsizeå°±è¿”å›žç»“æŸäº† if (mIndex == mPainters.size()) &#123; return; &#125; // è®¾ç½®progressæ—¶ä¼šä¸æ–­è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä¸ºäº†é¿å…ä¸æ–­åˆ›å»ºRealChainå¯¹è±¡ï¼Œ // è¿™é‡Œç”¨äº†SparseArrayä¿å­˜æ‰€æœ‰å·²ç»åˆ›å»ºçš„RealChainå¯¹è±¡ï¼Œkeyä¸ºindex Chain next = mChainPool.get(mIndex); if (next == null) &#123; next = new RealChain(mPainters, mIndex + 1, mAction); next.setOnFinishListener(mOnFinishListener); mChainPool.put(mIndex, next); &#125; final Painter painter = mPainters.get(mIndex); painter.start(next, mAction);&#125; è¿™é‡Œç…§æ¬äº†OkHttpï¼Œé€šè¿‡åœ¨RealChainçš„proccedæ–¹æ³•åˆ›å»ºæ–°çš„RealChainå¯¹è±¡å®žçŽ°Painterçš„ä¾æ¬¡æ‰§è¡Œã€‚ç”±äºŽPainteréƒ½æ˜¯è‡ªå®šä¹‰çš„ï¼Œæ‰€ä»¥å½“indexç­‰äºŽæ‰€æœ‰Painterçš„sizeæ—¶returnå°±å¥½äº†ï¼Œè€ŒOkHttpçš„æœ€åŽä¸€ä¸ªInterceptoræ˜¯æ²¡æœ‰åˆ›å»ºChainçš„ã€‚ ActionæŽ¥å£ActionæŽ¥å£ä¸»è¦æä¾›äº†è®¡ç®—å½“å‰pathå®žé™…åæ ‡ç‚¹ã€é€šçŸ¥æ›´æ–°Viewä»¥åŠè®¾ç½®æˆ–è€…èŽ·å–Viewçš„æ‰€éœ€çš„å‚æ•°çš„åŠŸèƒ½ï¼Œè¿™ä¹Ÿæ˜¯Viewéœ€è¦å®žçŽ°çš„æŽ¥å£ã€‚123456789101112131415161718192021222324252627282930313233public interface Action &#123; /** * æ›´æ–°viewï¼Œå®žé™…è°ƒç”¨çš„æ˜¯&#123;@link SimpleLineView#postInvalidate()&#125;æ–¹æ³• * @param painter è¯¥painterå®žçŽ°viewçš„onDraw */ void update(Painter painter); /** * å¯¹å¤–æŽ¥å£ï¼Œè®¾ç½®progressåŽæ›´æ–°view * @param progress */ void setProgress(int progress); /** * painterä¸­é€šè¿‡è°ƒç”¨è¯¥æŽ¥å£è¿›è¡Œç›¸åº”çš„ç»˜åˆ¶å·¥ä½œ * @return */ int getProgress(); /** * é€šè¿‡å½“å‰viewæ‰§è¡Œçš„çŠ¶æ€ä½œå‡ºç›¸åº”å¤„ç†ï¼Œå¯å‚è€ƒ&#123;@link com.robog.library.painter.TaskPainter#start(Chain, Action)&#125;æ–¹æ³• * @return */ int getStatus(); /** * èŽ·å¾—å½“å‰painterä¸‹æ‰€æœ‰ç‚¹çš„å®žé™…åæ ‡ * @param painter * @return */ List&lt;PixelPoint&gt; fetchCoordinate(Painter painter);&#125; çœ‹ä¸€ä¸‹fetchCoordinateæ–¹æ³•ï¼š1234567891011121314@Overridepublic List&lt;PixelPoint&gt; fetchCoordinate(Painter painter) &#123; // åŒæ ·çš„ï¼Œè¿™é‡Œé¿å…é¢‘ç¹è®¾ç½®progressä¸æ–­åˆ›å»ºPixelPointå¯¹è±¡ List&lt;PixelPoint&gt; pixelPoints = mPointPool.get(painter); if (pixelPoints != null) &#123; return pixelPoints; &#125; pixelPoints = new ArrayList&lt;&gt;(); Utils.setPoint(painter, pixelPoints, mWidth, mHeight); mPointPool.put(painter, pixelPoints); return pixelPoints;&#125; Utilsçš„setPointæ–¹æ³•ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041public static void setPoint(Painter painter, List&lt;PixelPoint&gt; pixelPoints, int width, int height) &#123; // å…ˆèŽ·å–PixelPath final PixelPath pixelPath = painter.getPixelPath(); final int[] path = pixelPath.getPath(); final int horizontal = pixelPath.getHorizontal(); final int vertical = pixelPath.getVertical(); for (int target : path) &#123; // å¦‚æžœPixelPathä¸­ç‚¹çš„åºå·è¶…è¿‡æ€»æ•°åˆ™æŠ›å‡ºå¼‚å¸¸ if (target &gt; horizontal * vertical) &#123; throw new IllegalArgumentException("Current coordinate [" + target + "] is invalid!"); &#125; // å•† int quotient = target / horizontal; // ä½™æ•° int remainder = target % horizontal; // å®žé™…çš„xå’Œyåæ ‡ float x; float y; // xå’Œyåæ ‡çš„ç³»æ•° float coefficientX; float coefficientY; if (remainder != 0) &#123; // ä½™æ•°ä¸ä¸º0æ—¶ï¼Œè¿™é‡Œçš„0.5æ˜¯è®©å®žé™…åæ ‡ç‚¹ä½äºŽæ–¹æ ¼ä¸­å¿ƒç‚¹ coefficientX = remainder - 0.5f; coefficientY = quotient + 0.5f; &#125; else &#123; // ä½™æ•°ä¸º0æ—¶ coefficientX = horizontal - 0.5f; coefficientY = quotient - 0.5f; &#125; // width / horizontalä¸ºæ¯ä¸ªæ–¹æ ¼çš„å®½åº¦ // æ¯ä¸ªæ–¹æ ¼çš„å®½åº¦ä¹˜ç³»æ•°å³ä¸ºxçš„åæ ‡ x = coefficientX * width / horizontal; // åŒç† y = coefficientY * height / vertical; PixelPoint pixelPoint = new PixelPoint(x, y); pixelPoints.add(pixelPoint); &#125;&#125; ç”¨çš„å°å­¦æ•°å­¦ï¼Œçœ‹ä¸€ä¸‹æ³¨é‡Šå°±å¥½äº†ã€‚æŽ¥ç€çœ‹ä¸€ä¸‹updateå’ŒonDrawæ–¹æ³•ï¼š1234567891011@Overridepublic void update(Painter painter) &#123; mCurrentPainter = painter; postInvalidate();&#125;@Overrideprotected void onDraw(Canvas canvas) &#123; if (mCurrentPainter != null) &#123; mCurrentPainter.onDraw(canvas); &#125;&#125; åœ¨updateä¸­è®¾ç½®å½“å‰çš„painterï¼Œç”±äºŽä¹‹å‰çš„æ“ä½œåœ¨çº¿ç¨‹ä¸­ï¼Œè¿™é‡Œè°ƒç”¨postInvalidateé€šçŸ¥ç»˜åˆ¶ï¼Œåœ¨Viewçš„onDrawæ–¹æ³•ä¸­è°ƒç”¨Painterçš„onDrawå®žçŽ°ç»˜åˆ¶ã€‚ å…¶ä»–ä»‹ç»å®Œä¸‰ä¸ªæŽ¥å£ï¼Œæ•´ä½“çš„æµç¨‹ç®—æ˜¯ä»‹ç»å®Œäº†ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹ä¸¤ä¸ªåŠŸèƒ½åž‹çš„Painterã€‚ DelayPainter123456789101112@Overridepublic void start(Chain chain, Action action) &#123; try &#123; if (Looper.myLooper() == Looper.getMainLooper()) &#123; throw new RuntimeException("Can't delay in the main thread!"); &#125; Thread.sleep(mTime); chain.proceed(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;&#125; åœ¨startæ–¹æ³•é€šè¿‡Thread.sleepè¿›è¡Œå»¶æ—¶ï¼Œå¦‚æžœå½“å‰æ–¹æ³•åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚ TaskPainter123456789101112131415@Overridepublic void start(final Chain chain, final Action action) &#123; mIsRunning = true; EXECUTOR.execute(new Runnable() &#123; @Override public void run() &#123; // å½“statusä¸ºstartæ—¶é‡ç½®point if (action.getStatus() == STATUS_START) &#123; Utils.resetPointStatus(mPainterPool); &#125; chain.proceed(); mIsRunning = false; &#125; &#125;);&#125; å½“Painteræœ‰å¤šä¸ªæ—¶ï¼Œè®¡ç®—ä¼šè€—è´¹ä¸€å®šçš„æ—¶é—´ï¼Œè¿™é‡Œå°†chainçš„proccedç½®äºŽçº¿ç¨‹ä¸­ï¼Œè®©åŽç»­çš„è¿‡ç¨‹éƒ½åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œä»¥ä¿è¯åŠ¨ç”»çš„æµç•…ã€‚å¹¶ä¸”ï¼Œå½“startåŠ¨ç”»æ—¶ï¼Œå°†PixelPointçš„çŠ¶æ€é‡ç½®ï¼Œä¿è¯ä¸‹ä¸€æ¬¡ç»˜åˆ¶æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¿‡ç¨‹ã€‚ ä¸è¶³1ã€å›¾å½¢è¾ƒä¸ºå¤æ‚æ—¶ï¼Œé€šè¿‡PSèŽ·å–è®¡ç®—åæ ‡ç‚¹è¾ƒä¸ºç¹çã€‚2ã€ç”±äºŽè®¡ç®—åœ¨å­çº¿ç¨‹ï¼Œç»˜åˆ¶åœ¨ä¸»çº¿ç¨‹ï¼Œå½“SimpleLineViewè®¾ç½®progressè¿‡å¿«æ—¶ï¼Œä¸Šä¸€æ­¥onDrawå¯èƒ½æœªå®Œæˆï¼Œç”»é¢å¯èƒ½ä¼šé—ªåŠ¨ï¼Œæš‚æ—¶çš„è§£å†³æ–¹æ³•æ˜¯å°†æ­¤è¿‡ç¨‹æ”¾å…¥ä¸»çº¿ç¨‹ã€‚ä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼š12mView.addPainter(mCicleProgressPainter).addPainter(mHookProgressPainter).onMain();mView.setProgress(progress); OKï¼ŒåŸºæœ¬ä¸Šä»‹ç»å®Œäº†ï¼Œå¦‚æžœæœ‰ä»€ä¹ˆä¸è¶³æˆ–è€…æœ‰ä»€ä¹ˆé—®é¢˜æ¬¢è¿ŽæŒ‡æ­£ï¼ é¡¹ç›®åœ°å€ï¼šhttps://github.com/XingdongYu/SimpleLineView]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æµ…è°ˆAndroidä¸­çš„ç¼“å­˜(ä¸€)â€”â€”å†…å­˜ç¼“å­˜]]></title>
    <url>%2F2018%2F07%2F03%2Fandroid-cache-1%2F</url>
    <content type="text"><![CDATA[å†…å­˜ç¼“å­˜ä¸€èˆ¬é€šè¿‡Mapã€Listã€é“¾è¡¨ç­‰é›†åˆå®žçŽ°ã€‚æ¯æ¬¡å°†æ–°å»ºçš„å¯¹è±¡å­˜å…¥é›†åˆï¼Œä¸‹ä¸€æ¬¡éœ€è¦æ–°å»ºæ—¶ç›´æŽ¥ä»Žé›†åˆä¸­åŽ»å–ï¼Œè¿™æ ·é¿å…äº†æ¯æ¬¡æ–°å»ºå¯¹è±¡å¸¦æ¥çš„å¼€é”€ä»¥åŠå†…å­˜å ç”¨ã€‚ Mapæˆ‘ä»¬é€šè¿‡lifecycleåŒ…åˆ›å»ºViewModelæ—¶ä¼šé€šè¿‡è¿™æ ·çš„æ–¹å¼: 1ViewModelProviders.of(activity).get(MyViewModel.class); çœ‹ä¸€ä¸‹getæ–¹æ³•:1234567891011121314151617181920212223public &lt;T extends ViewModel&gt; T get(@NonNull Class&lt;T&gt; modelClass) &#123; String canonicalName = modelClass.getCanonicalName(); if (canonicalName == null) &#123; throw new IllegalArgumentException("Local and anonymous classes can not be ViewModels"); &#125; return get(DEFAULT_KEY + ":" + canonicalName, modelClass);&#125;public &lt;T extends ViewModel&gt; T get(@NonNull String key, @NonNull Class&lt;T&gt; modelClass) &#123; ViewModel viewModel = mViewModelStore.get(key); if (modelClass.isInstance(viewModel)) &#123; return (T) viewModel; &#125; else &#123; if (viewModel != null) &#123; // TODO: log a warning. &#125; &#125; viewModel = mFactory.create(modelClass); mViewModelStore.put(key, viewModel); return (T) viewModel;&#125; å¯ä»¥çœ‹åˆ°ï¼ŒViewModelæ˜¯é€šè¿‡mViewModelStore.get(key)åŽ»èŽ·å–çš„ï¼Œkeyä¸ºDEFAULT_KEY + â€œ:â€ + canonicalNameã€‚å¦‚æžœä¸ºç©ºå°±æ–°å»ºä¸€ä¸ªï¼Œç„¶åŽå­˜å…¥mViewModelStoreã€‚å¦‚æžœä¸‹ä¸€æ¬¡éœ€è¦æ–°å»ºç›¸åŒçš„ViewModelç±»ï¼Œç›´æŽ¥ä»ŽmViewModelStoreå–å°±å¥½äº†ã€‚çœ‹ä¸€ä¸‹mViewModelStore:1234567891011121314151617public class ViewModelStore &#123; private final HashMap&lt;String, ViewModel&gt; mMap = new HashMap&lt;&gt;(); final void put(String key, ViewModel viewModel) &#123; ViewModel oldViewModel = mMap.put(key, viewModel); if (oldViewModel != null) &#123; oldViewModel.onCleared(); &#125; &#125; final ViewModel get(String key) &#123; return mMap.get(key); &#125; // çœç•¥&#125; ViewModelStoreå¾ˆç®€å•ï¼Œç»´æŠ¤äº†ä¸€ä¸ªHashMapï¼Œå­˜å‚¨å°±æ˜¯é€šè¿‡HashMapå®žçŽ°çš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ç¼“å­˜ç­–ç•¥ã€‚å¦‚æžœkeyä¸ºintï¼Œé€‰ç”¨SparseArrayæ›´ä½³ã€‚ä¹‹å‰å†™çš„åº“SimpleLineViewä¸­å› ä¸ºä¼šé¢‘ç¹åˆ›å»ºPointï¼Œç”¨äº†HashMapç¼“å­˜Pointã€‚ é“¾è¡¨æˆ‘ä»¬é€šå¸¸åœ¨åˆ›å»ºMessageæ—¶ä¸ä¼šé€šè¿‡newå…³é”®å­—æ¥åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡Message.obtain()ã€‚åœ¨çœ‹obtainæ–¹æ³•ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹Messageä¸­çš„recycleUncheckedæ–¹æ³•:12345678910111213141516171819202122232425private static Message sPool;private static int sPoolSize = 0;private static final int MAX_POOL_SIZE = 50;void recycleUnchecked() &#123; flags = FLAG_IN_USE; what = 0; arg1 = 0; arg2 = 0; obj = null; replyTo = null; sendingUid = -1; when = 0; target = null; callback = null; data = null; synchronized (sPoolSync) &#123; if (sPoolSize &lt; MAX_POOL_SIZE) &#123; next = sPool; sPool = this; sPoolSize++; &#125; &#125; &#125; æˆ‘ä»¬çŸ¥é“æ¯æ¬¡Messageå¤„ç†å®ŒåŽï¼ŒLooperä¼šè°ƒç”¨Messageçš„recycleUncheckedæ–¹æ³•æ¥å›žæ”¶è¯¥Messageå¯¹è±¡ã€‚æ–¹æ³•ä¸»è¦æ˜¯å°†å½“å‰Messageçš„å‚æ•°é‡ç½®ï¼Œç„¶åŽæ”¾å…¥Messageæ± â€”â€”sPool(æœ€å¤š50ä¸ª)ã€‚sPoolä¸ºé™æ€Messageå˜é‡ï¼Œå°†å½“å‰Messageæ’åˆ°sPoolæ‰€å¼•ç”¨çš„Messageå¯¹è±¡å‰é¢ï¼Œå¹¶ä¸”è®©sPoolæŒ‡å‘å½“å‰Messageï¼Œå¦‚æ­¤å°±å½¢æˆäº†ä¸€ä¸ªç¼“å­˜é“¾ã€‚ å†æ¥çœ‹ä¸€ä¸‹obtainæ–¹æ³•:12345678910111213public static Message obtain() &#123; synchronized (sPoolSync) &#123; if (sPool != null) &#123; Message m = sPool; sPool = m.next; m.next = null; m.flags = 0; // clear in-use flag sPoolSize--; return m; &#125; &#125; return new Message();&#125; å¦‚æžœsPoolä¸ä¸ºç©ºï¼Œå°±è¿”å›žsPoolæ‰€å¼•ç”¨çš„Messageå¯¹è±¡ï¼Œå¹¶ä¸”è®©sPoolæŒ‡å‘å®ƒçš„nextï¼Œå³å½“å‰Messageçš„ä¸‹ä¸€ä¸ªMessageå¯¹è±¡ï¼Œå³obtainæ–¹æ³•ä¸‹ä¸€æ¬¡è°ƒç”¨æ—¶æ‰€è¿”å›žçš„å¯¹è±¡ã€‚æœ€è¿‘å†™çš„æŒä¹…åŒ–æ—¥å¿—åº“PersistentLogå› ä¸ºä¼šé¢‘ç¹åˆ›å»ºæ—¥å¿—å¯¹è±¡LogBeanï¼Œå‚ç…§Messageå†™äº†ç¼“å­˜æ± ã€‚ Listç›®å‰æ²¡æƒ³åˆ°ä¾‹å­ï¼Œæƒ³èµ·æ¥äº†å†è¡¥ðŸ¶]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello Blog]]></title>
    <url>%2F2018%2F07%2F02%2Fhello-blog%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰æ–‡ç« ä¸€ç›´åœ¨cnblogä¸Šå†™ï¼Œè™½ç„¶ä¸å¤šå´ä¹ŸèŠ±è´¹äº†ä¸å°‘å¿ƒæ€ï¼Œæ‰€ä»¥ä¼šæŠŠè¿™äº›æ–‡ç« é™†ç»­è¿ç§»è¿‡æ¥ã€‚ä»¥åŽå¦‚æžœè¸©äº†ä»€ä¹ˆå‘æˆ–è€…æœ‰ä»€ä¹ˆå¥½çŽ©çš„ä¸œè¥¿ä¹Ÿéƒ½ä¼šæ”¾åœ¨è¿™å„¿ã€‚å¸Œæœ›èƒ½ä¸€ç›´åšæŒä¸‹åŽ»ã€‚ 2018.07.02by: RoboG]]></content>
  </entry>
</search>
