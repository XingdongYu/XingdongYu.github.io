<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[æµ…è°ˆAndroidä¸­çš„ç¼“å­˜(ä¸€)â€”â€”å†…å­˜ç¼“å­˜]]></title>
    <url>%2F2018%2F07%2F03%2F%E6%B5%85%E8%B0%88Android%E4%B8%AD%E7%9A%84%E7%BC%93%E5%AD%981%2F</url>
    <content type="text"><![CDATA[å†…å­˜ç¼“å­˜ä¸€èˆ¬é€šè¿‡Mapã€Listã€é“¾è¡¨ç­‰é›†åˆå®žçŽ°ã€‚å°†å·²åˆ›å»ºçš„å¯¹è±¡æ”¾å…¥é›†åˆä¸­ï¼Œç­‰ä¸‹æ¬¡éœ€è¦æ–°å»ºæ—¶ï¼Œç›´æŽ¥ä»Žé›†åˆä¸­åŽ»å–ã€‚å¦‚æžœé›†åˆä¸­çš„å¯¹è±¡å·²è¢«å›žæ”¶ï¼Œå°±é‡å¤ä¸Šè¿°æ­¥éª¤ã€‚è¿™æ ·é¿å…äº†æ¯æ¬¡æ–°å»ºå¯¹è±¡å¸¦æ¥çš„å¼€é”€ä»¥åŠå†…å­˜å ç”¨ã€‚ ä¸€ã€Mapæˆ‘ä»¬é€šè¿‡lifecycleåŒ…åˆ›å»ºViewModelæ—¶ä¼šé€šè¿‡è¿™æ ·çš„æ–¹å¼: 1ViewModelProviders.of(activity).get(MyViewModel.class); çœ‹ä¸€ä¸‹getæ–¹æ³•:1234567891011121314151617181920212223242526public &lt;T extends ViewModel&gt; T get(@NonNull Class&lt;T&gt; modelClass) &#123; String canonicalName = modelClass.getCanonicalName(); if (canonicalName == null) &#123; throw new IllegalArgumentException("Local and anonymous classes can not be ViewModels"); &#125; return get(DEFAULT_KEY + ":" + canonicalName, modelClass);&#125;public &lt;T extends ViewModel&gt; T get(@NonNull String key, @NonNull Class&lt;T&gt; modelClass) &#123; ViewModel viewModel = mViewModelStore.get(key); if (modelClass.isInstance(viewModel)) &#123; //noinspection unchecked return (T) viewModel; &#125; else &#123; //noinspection StatementWithEmptyBody if (viewModel != null) &#123; // TODO: log a warning. &#125; &#125; viewModel = mFactory.create(modelClass); mViewModelStore.put(key, viewModel); //noinspection unchecked return (T) viewModel;&#125; å¯ä»¥çœ‹åˆ°ï¼ŒViewModelæ˜¯é€šè¿‡mViewModelStore.get(key)åŽ»èŽ·å–çš„ï¼Œkeyä¸ºDEFAULT_KEY + â€œ:â€ + canonicalNameã€‚å¦‚æžœä¸ºç©ºå°±æ–°å»ºä¸€ä¸ªï¼Œç„¶åŽå­˜å…¥mViewModelStoreã€‚å¦‚æžœä¸‹ä¸€æ¬¡éœ€è¦æ–°å»ºåŒä¸€ä¸ªViewModelç±»ï¼Œç›´æŽ¥ä»ŽmViewModelStoreå–å°±å¥½äº†ã€‚çœ‹ä¸€ä¸‹mViewModelStore:1234567891011121314151617public class ViewModelStore &#123; private final HashMap&lt;String, ViewModel&gt; mMap = new HashMap&lt;&gt;(); final void put(String key, ViewModel viewModel) &#123; ViewModel oldViewModel = mMap.put(key, viewModel); if (oldViewModel != null) &#123; oldViewModel.onCleared(); &#125; &#125; final ViewModel get(String key) &#123; return mMap.get(key); &#125; // çœç•¥&#125; ViewModelStoreå¾ˆç®€å•ï¼Œç»´æŠ¤äº†ä¸€ä¸ªHashMapã€‚ViewModelStoreå­˜å‚¨å°±æ˜¯é€šè¿‡HashMapå®žçŽ°çš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ç¼“å­˜ç­–ç•¥ã€‚å¦‚æžœkeyä¸ºintï¼Œé€‰ç”¨SparseArrayæ›´ä½³ã€‚ä¹‹å‰å†™çš„åº“SimpleLineViewä¸­å› ä¸ºä¼šé¢‘ç¹åˆ›å»ºPointï¼Œç”¨äº†HashMapç¼“å­˜Pointã€‚ äºŒã€é“¾è¡¨æˆ‘ä»¬é€šå¸¸åœ¨åˆ›å»ºMessageæ—¶ä¸ä¼šé€šè¿‡newå…³é”®å­—æ¥åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡Message.obtain()ã€‚åœ¨çœ‹obtainæ–¹æ³•ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹Messageä¸­çš„recycleUncheckedæ–¹æ³•:12345678910111213141516171819202122232425private static Message sPool;private static int sPoolSize = 0;private static final int MAX_POOL_SIZE = 50;void recycleUnchecked() &#123; flags = FLAG_IN_USE; what = 0; arg1 = 0; arg2 = 0; obj = null; replyTo = null; sendingUid = -1; when = 0; target = null; callback = null; data = null; synchronized (sPoolSync) &#123; if (sPoolSize &lt; MAX_POOL_SIZE) &#123; next = sPool; sPool = this; sPoolSize++; &#125; &#125; &#125; æˆ‘ä»¬çŸ¥é“æ¯æ¬¡æˆåŠŸå¤„ç†MessageåŽï¼ŒLooperä¼šè°ƒç”¨Messageçš„recycleUncheckedæ–¹æ³•ç”¨äºŽå›žæ”¶Messageã€‚ä¸»è¦æ˜¯å°†å½“å‰Messageä¸€äº›å‚æ•°é‡ç½®ï¼Œç„¶åŽæ”¾å…¥Messageæ± â€”â€”sPool(æœ€å¤š50ä¸ª)ã€‚sPoolä¸ºé™æ€Messageå˜é‡ï¼Œå°†å½“å‰Messageæ’åˆ°sPoolæ‰€å¼•ç”¨çš„Messageå¯¹è±¡å‰é¢ï¼Œå¹¶ä¸”è®©sPoolæŒ‡å‘å½“å‰Messageã€‚è¿™æ ·ä¿è¯äº†Messageé“¾è¡¨å¤´éƒ¨çš„ä¸ºæœ€æ–°å¯¹è±¡ã€‚ å†æ¥çœ‹ä¸€ä¸‹obtainæ–¹æ³•:12345678910111213public static Message obtain() &#123; synchronized (sPoolSync) &#123; if (sPool != null) &#123; Message m = sPool; sPool = m.next; m.next = null; m.flags = 0; // clear in-use flag sPoolSize--; return m; &#125; &#125; return new Message();&#125; å¦‚æžœsPoolä¸ä¸ºç©ºï¼Œå°±è¿”å›žsPoolæ‰€å¼•ç”¨çš„Messageå¯¹è±¡ï¼Œå¹¶ä¸”è®©sPoolæŒ‡å‘å®ƒçš„nextï¼Œå³å½“å‰Messageçš„ä¸‹ä¸€ä¸ªMessageå¯¹è±¡ï¼Œå³obtainæ–¹æ³•ä¸‹ä¸€æ¬¡è°ƒç”¨æ—¶æ‰€è¿”å›žçš„å¯¹è±¡ã€‚æœ€è¿‘å†™çš„æŒä¹…åŒ–æ—¥å¿—åº“PersistentLogå› ä¸ºä¼šé¢‘ç¹åˆ›å»ºæ—¥å¿—å¯¹è±¡LogBeanï¼Œå‚ç…§Messageå†™äº†ç¼“å­˜æ± ã€‚ ä¸‰ã€Listç›®å‰æ²¡æƒ³åˆ°ä¾‹å­ï¼Œæƒ³èµ·æ¥äº†å†è¡¥ðŸ¶]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello Blog]]></title>
    <url>%2F2018%2F07%2F02%2Fhello-blog%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰æ–‡ç« ä¸€ç›´åœ¨cnblogä¸Šå†™ï¼Œè™½ç„¶ä¸å¤šå´ä¹ŸèŠ±è´¹äº†ä¸å°‘å¿ƒæ€ï¼Œæ‰€ä»¥ä¼šæŠŠè¿™äº›æ–‡ç« é™†ç»­è¿ç§»è¿‡æ¥ã€‚ä»¥åŽå¦‚æžœè¸©äº†ä»€ä¹ˆå‘æˆ–è€…æœ‰ä»€ä¹ˆå¥½çŽ©çš„ä¸œè¥¿ä¹Ÿéƒ½ä¼šæ”¾åœ¨è¿™å„¿ã€‚å¸Œæœ›èƒ½ä¸€ç›´åšæŒä¸‹åŽ»ã€‚ 2018.07.02by: RoboG]]></content>
  </entry>
</search>
